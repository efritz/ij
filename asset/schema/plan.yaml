---

definitions:
  stringOrList:
    oneOf:
      - type: string
      - type: array
        items:
          type: string
  stageTask:
    oneOf:
      - type: string
      - type: object
        properties:
          name:
            type: string
          environment:
            $ref: '#/definitions/stringOrList'
        additionalProperties: false
        required:
          - name

type: object
properties:
  extend:
    type: boolean
  stages:
    type: array
    items:
      type: object
      properties:
        name:
          type: string
        before_stage:
          type: string
        after_stage:
          type: string
        tasks:
          type: array
          items:
            $ref: '#/definitions/stageTask'
        run-mode:
          type: string
          enum:
            - always
            - on-success
            - on-failure
        parallel:
          type: boolean
        environment:
          $ref: '#/definitions/stringOrList'
      additionalProperties: false
      required:
        - name
  environment:
    $ref: '#/definitions/stringOrList'
additionalProperties: false
